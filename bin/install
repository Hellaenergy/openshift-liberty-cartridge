#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

client_message "liberty install"

if [ ! -d "$OPENSHIFT_LIBERTY_DIR/usr/wlp" ]; then
  client_message "downloading liberty"
  $OPENSHIFT_LIBERTY_DIR/bin/cache_liberty $OPENSHIFT_LIBERTY_DIR/usr
fi

echo "host=$OPENSHIFT_LIBERTY_IP" >> $OPENSHIFT_LIBERTY_DIR/template/servers/defaultServer/bootstrap.properties
echo "http.port=$OPENSHIFT_LIBERTY_PORT" >> $OPENSHIFT_LIBERTY_DIR/template/servers/defaultServer/bootstrap.properties

cp -r $OPENSHIFT_LIBERTY_DIR/template/servers $OPENSHIFT_LIBERTY_DIR/
mkdir -p $OPENSHIFT_LIBERTY_DIR/servers/defaultServer/{apps,dropins}
mkdir -p $OPENSHIFT_LIBERTY_DIR/log

pushd $OPENSHIFT_LIBERTY_DIR/template/project/src/main/webapp 1> /dev/null
  jar cvf ${OPENSHIFT_LIBERTY_DIR}/servers/defaultServer/apps/ROOT.war ./*
popd 1> /dev/null

